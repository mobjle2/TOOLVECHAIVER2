<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tool Ve Chai Premium</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,sans-serif;
  background:linear-gradient(135deg,#0f172a,#1e293b);
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}

.container{
  width:100%;
  max-width:480px;
  padding:30px;
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(20px);
  border-radius:20px;
  box-shadow:0 15px 40px rgba(0,0,0,0.5);
}

h1{
  text-align:center;
  margin-bottom:30px;
  background:linear-gradient(90deg,#facc15,#f97316);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  font-weight:700;
}

input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.1);
  background:rgba(255,255,255,0.05);
  color:white;
  margin-bottom:12px;
  outline:none;
  transition:0.3s;
}

input:focus{
  border-color:#facc15;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  font-weight:600;
  cursor:pointer;
  transition:0.3s;
  margin-top:8px;
}

.btn-primary{
  background:linear-gradient(90deg,#2563eb,#3b82f6);
}
.btn-primary:hover{
  transform:translateY(-2px);
  box-shadow:0 8px 20px rgba(59,130,246,0.4);
}

.btn-success{
  background:linear-gradient(90deg,#16a34a,#22c55e);
}
.btn-danger{
  background:linear-gradient(90deg,#dc2626,#ef4444);
}
.btn-warning{
  background:linear-gradient(90deg,#f59e0b,#f97316);
}

.status{
  margin-top:10px;
  font-weight:600;
  text-align:center;
}

.admin-box{
  margin-top:25px;
}

.link-card{
  background:rgba(255,255,255,0.05);
  padding:15px;
  border-radius:12px;
  margin-bottom:10px;
}

.badge{
  padding:4px 10px;
  border-radius:20px;
  font-size:12px;
}

.open{background:#16a34a;}
.closed{background:#dc2626;}

.hidden{display:none;}
hr{
  border:1px solid rgba(255,255,255,0.1);
  margin:20px 0;
}
</style>
</head>
<body>

<div class="container">

<h1>Tool Ve Chai</h1>

<!-- LOGIN -->
<div id="loginBox">
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button class="btn-primary" onclick="login()">ĐĂNG NHẬP</button>
  <div id="loginError" class="status"></div>
</div>

<!-- CHECK -->
<div id="checkBox" class="hidden">
  <input id="codeInput" placeholder="Nhập mã...">
  <button class="btn-success" onclick="checkCode()">CHECK</button>
  <div id="checkResult" class="status"></div>
</div>

<!-- ADMIN -->
<div id="adminBox" class="admin-box hidden">
  <hr>
  <button class="btn-success" onclick="createLink()">+ Tạo Link</button>
  <div id="linkGrid"></div>
</div>

</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "toolvechai.firebaseapp.com",
  projectId: "toolvechai"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* ===== AUTH STATE ===== */

auth.onAuthStateChanged(async(user)=>{
  if(user){
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("checkBox").classList.remove("hidden");

    const doc = await db.collection("users").doc(user.email).get();
    if(doc.exists && doc.data().role === "admin_v2"){
      document.getElementById("adminBox").classList.remove("hidden");
      loadLinks();
    }
  }
});

/* ===== LOGIN ===== */

function login(){
  const email = document.getElementById("email").value.trim();
  const pass = document.getElementById("password").value.trim();

  auth.signInWithEmailAndPassword(email,pass)
  .catch(()=>{
    document.getElementById("loginError").innerText="Sai tài khoản!";
  });
}

/* ===== CHECK ===== */

function checkCode(){
  const code = document.getElementById("codeInput").value.trim();
  const result = document.getElementById("checkResult");

  if(code.length < 4){
    result.innerHTML="❌ Mã không hợp lệ";
    result.style.color="#ef4444";
  }else{
    result.innerHTML="✅ Hợp lệ";
    result.style.color="#22c55e";
  }
}

/* ===== ADMIN ===== */

function randomId(){
  return Math.random().toString(36).substring(2,9);
}

async function createLink(){
  const id = randomId();
  await db.collection("ToolVeChaiV2_links").doc(id).set({
    isActive:true,
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  });
  loadLinks();
}

async function loadLinks(){
  const snap = await db.collection("ToolVeChaiV2_links").get();
  const grid = document.getElementById("linkGrid");
  grid.innerHTML="";

  snap.forEach(doc=>{
    const data = doc.data();
    grid.innerHTML+=`
      <div class="link-card">
        <b>${doc.id}</b><br><br>
        <span class="badge ${data.isActive?'open':'closed'}">
          ${data.isActive?'ĐANG MỞ':'ĐÃ KHÓA'}
        </span>
        <br><br>
        <button class="btn-warning" onclick="resetLink('${doc.id}')">Reset</button>
        <button class="btn-danger" onclick="deleteLink('${doc.id}')">Xóa</button>
      </div>
    `;
  });
}

async function resetLink(id){
  await db.collection("ToolVeChaiV2_links").doc(id).update({isActive:true});
  loadLinks();
}

async function deleteLink(id){
  await db.collection("ToolVeChaiV2_links").doc(id).delete();
  loadLinks();
}
</script>

</body>
</html>
