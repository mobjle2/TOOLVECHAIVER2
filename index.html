<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CHECK VIP V2</title>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<style>
body{
  font-family:Arial;
  background:#111;
  color:white;
  margin:0;
}
.container{
  max-width:900px;
  margin:auto;
  padding:20px;
}
input{
  width:100%;
  padding:16px;
  border-radius:12px;
  border:1px solid #333;
  background:#111;
  color:white;
  font-size:16px;
  margin-top:15px;
}
button{
  width:100%;
  padding:16px;
  border-radius:12px;
  border:none;
  background:#2563eb;
  color:white;
  font-weight:bold;
  font-size:16px;
  margin-top:15px;
  cursor:pointer;
}
.item{
  background:#1a1a1a;
  padding:15px;
  margin-bottom:10px;
  border-radius:10px;
}
.badge{
  display:inline-block;
  padding:4px 10px;
  border-radius:20px;
  font-size:12px;
  margin-top:5px;
}
</style>
</head>

<body>

<div id="loginScreen" style="
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:#000;
display:flex;
justify-content:center;
align-items:center;
z-index:9999;
">
  <div style="width:360px;background:#111;padding:30px;border-radius:20px;border:1px solid gold;">
    <h2 style="text-align:center;color:gold;">ğŸ” Tool Ve Chai Admin</h2>
    <input id="loginEmail" type="email" placeholder="Nháº­p Gmail">
    <input id="loginPass" type="password" placeholder="Nháº­p Password">
    <button onclick="secureLogin()">LOGIN</button>
    <div id="loginError" style="color:red;text-align:center;margin-top:10px;"></div>
  </div>
</div>

<div class="container">
  <h2>ğŸ›  Tool Ve Chai Check VIP V2</h2>
  <input id="q" placeholder="Nháº­p Ä‘Ãºng 3 kÃ½ tá»±">
  <button onclick="check()">CHECK</button>
  <div id="out" style="margin-top:20px;"></div>
</div>

<script>

const firebaseConfig = {
  apiKey: "AIzaSyCEL7BDXvmNi2dp1VNpua7b2plpTiTOK3U",
  authDomain: "toolvechai.firebaseapp.com",
  projectId: "toolvechai",
  storageBucket: "toolvechai.firebasestorage.app",
  messagingSenderId: "947125032083",
  appId: "1:947125032083:web:a7335aa5fd446a44446966",
  measurementId: "G-N4W751H36H"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

auth.setPersistence(firebase.auth.Auth.Persistence.NONE);

// LOGIN
function secureLogin(){
  const email = loginEmail.value.trim();
  const pass = loginPass.value.trim();

  auth.signInWithEmailAndPassword(email, pass)
    .then(async (userCredential) => {

      const user = userCredential.user;

      const doc = await db.collection("users")
        .doc(user.email)
        .get();

      if(!doc.exists || doc.data().role !== "admin_v2"){
        await auth.signOut();
        loginError.innerText = "KhÃ´ng cÃ³ quyá»n vÃ o TOOL V2";
        return;
      }

      loginScreen.remove();
    })
    .catch(()=>{
      loginError.innerText = "Sai Gmail hoáº·c Password!";
    });
}


auth.onAuthStateChanged(function(user){
  if(user){
    document.getElementById("loginScreen").remove();
  }
});

// CHECK
async function check(){

  const key = document.getElementById("q").value
    .toUpperCase()
    .replace(/[^A-Z0-9]/g,"");

  const out = document.getElementById("out");
  out.innerHTML = "";

  if(!key) return;

  let results = new Map();

 if(key.length === 4){

  const prefixSnap = await db.collection("codes_v2")
    .where("prefix4","==",key)
    .get();

  const suffixSnap = await db.collection("codes_v2")
    .where("suffix4","==",key)
    .get();

    prefixSnap.forEach(doc=>results.set(doc.id,doc.data()));
    suffixSnap.forEach(doc=>results.set(doc.id,doc.data()));

  } else {

    const snap = await db.collection("codes_v2")
  .where("search","==",key)
  .get();


    snap.forEach(doc=>results.set(doc.id,doc.data()));
  }

  if(results.size === 0){
    out.innerHTML = "âŒ KhÃ´ng xÃ¡c Ä‘á»‹nh mÃ£";
    return;
  }

  results.forEach(x=>{
    out.innerHTML += `
      <div class="item">
        <div style="font-weight:700;">âš¡ ${x.code}</div>
        ${x.mmc ? `<div class="badge">ğŸ’¾ ${x.mmc}</div>` : ""}
        ${x.vip ? `<div class="badge">ğŸ‘‘ ${x.vip}</div>` : ""}
      </div>
    `;
  });
}
</script>


</body>
</html>
