<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tool Ve Chai V2</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,sans-serif;
  background:#0b0f1a;
  color:white;
}

.wrapper{
  max-width:1200px;
  margin:auto;
  padding:40px 20px;
}

h1{
  color:#facc15;
  margin-bottom:25px;
}

input{
  width:100%;
  padding:14px;
  border-radius:10px;
  border:1px solid #1f2937;
  background:#111827;
  color:white;
}

button{
  cursor:pointer;
  font-weight:600;
  border:none;
  border-radius:8px;
}

.btn-blue{background:#2563eb;color:white;padding:12px 18px;}
.btn-green{background:#16a34a;color:white;padding:12px 18px;}
.btn-red{background:#dc2626;color:white;padding:12px 18px;}

.section{
  margin-bottom:40px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:16px;
}

@media(max-width:1024px){
  .grid{grid-template-columns:repeat(2,1fr);}
}

.card{
  background:#111827;
  padding:16px;
  border-radius:12px;
  border:1px solid #1f2937;
}

.card-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}

.actions{
  display:flex;
  gap:8px;
}

.icon-btn{
  width:36px;
  height:36px;
  border-radius:8px;
  background:#0f172a;
  border:1px solid #1f2937;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#94a3b8;
  transition:0.2s;
}

.icon-btn:hover{
  background:#1e293b;
  color:white;
}

.icon-btn.delete:hover{
  background:#dc2626;
  border-color:#dc2626;
}

.icon-btn.lock:hover{
  background:#f59e0b;
  border-color:#f59e0b;
  color:black;
}

.icon-btn.copy:hover{
  background:#2563eb;
  border-color:#2563eb;
}

.badge{
  padding:4px 10px;
  border-radius:20px;
  font-size:12px;
}

.open{background:#16a34a;}
.closed{background:#f59e0b;}

.hidden{display:none;}

.login-box{
  max-width:400px;
  margin:120px auto;
}
.login-container{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(135deg,#0b1220,#1e293b);
}

.login-card{
  width:420px;
  padding:45px;
  border-radius:20px;
  background:#1f2937;
  border:1px solid #2d3748;
  display:flex;
  flex-direction:column;
  gap:18px;
  box-shadow:0 25px 60px rgba(0,0,0,0.6);
}

.login-card h2{
  text-align:center;
  font-size:26px;
  color:#facc15;
  margin-bottom:10px;
}

.login-card input{
  padding:14px;
  border-radius:12px;
  border:1px solid #374151;
  background:#111827;
  color:white;
  font-size:14px;
}

.login-btn{
  padding:14px;
  border-radius:12px;
  border:none;
  font-weight:700;
  background:linear-gradient(135deg,#2563eb,#3b82f6);
  color:white;
  transition:0.2s;
}

.login-btn:hover{
  transform:translateY(-2px);
  box-shadow:0 10px 25px rgba(59,130,246,0.4);
}

#loginError{
  color:#ef4444;
  text-align:center;
  font-size:14px;
}

</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginBox" class="login-container">

  <div class="login-card">
    <h2>Tool Ve Chai V2</h2>

    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">

    <button class="login-btn" onclick="login()">ĐĂNG NHẬP</button>

    <div id="loginError"></div>
  </div>

</div>


<!-- MAIN -->
<div id="mainApp" class="wrapper hidden">

  <h1>Tool Ve Chai V2 Check VIP</h1>

  <!-- CHECK -->
  <div class="section">
    <div style="display:flex;gap:10px;">
      <input id="codeInput" placeholder="Nhập mã..." style="flex:1;">
      <button class="btn-blue" onclick="checkCode()">CHECK</button>
      <button class="btn-red" onclick="logout()">Đăng xuất</button>
    </div>

    <div id="checkResult" style="margin-top:15px;"></div>
  </div>

  <!-- ADMIN -->
  <div id="adminSection" class="section hidden">
    <hr style="border:1px solid #1f2937;margin:30px 0">
    <h2>Quản lý Link</h2>
    <button class="btn-green" onclick="createLink()">+ Tạo Link</button>
    <br><br>
    <div class="grid" id="linkGrid"></div>
  </div>

</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<script>

const firebaseConfig = {
  apiKey: "AIzaSyCEL7BDXvmNi2dp1VNpua7b2plpTiTOK3U",
  authDomain: "toolvechai.firebaseapp.com",
  projectId: "toolvechai"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const loginBox = document.getElementById("loginBox");
const mainApp = document.getElementById("mainApp");
const adminSection = document.getElementById("adminSection");

/* AUTH */

auth.onAuthStateChanged(async(user)=>{

/* AUTH */

auth.onAuthStateChanged(async(user)=>{
  if(user){
    loginBox.classList.add("hidden");
    mainApp.classList.remove("hidden");

    const doc = await db.collection("users").doc(user.email).get();

    if(doc.exists && doc.data().role === "admin_v2"){
      adminSection.classList.remove("hidden");
      loadLinks();
    }else{
      adminSection.classList.add("hidden");
    }

  }else{
    loginBox.classList.remove("hidden");
    mainApp.classList.add("hidden");
  }
});

function login(){
  const emailVal = document.getElementById("email").value.trim();
  const passVal = document.getElementById("password").value.trim();

  document.getElementById("loginError").innerText = "";

  auth.signInWithEmailAndPassword(emailVal, passVal)
  .catch((error)=>{
    document.getElementById("loginError").innerText = "Sai tài khoản hoặc mật khẩu!";
    console.log(error);
  });
}


/* CHECK */

function checkCode(){
  const code=codeInput.value.trim();
  if(code.length<4){
    checkResult.innerHTML='<span class="badge closed">Mã không hợp lệ</span>';
  }else{
    checkResult.innerHTML='<span class="badge open">Hợp lệ</span>';
  }
}

/* ADMIN */

function randomId(){
  return Math.random().toString(36).substring(2,9);
}

async function createLink(){
  const id=randomId();
  await db.collection("ToolVeChaiV2_links").doc(id).set({
    isActive:true,
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  });
  loadLinks();
}

async function loadLinks(){
  const snap=await db.collection("ToolVeChaiV2_links").get();
  linkGrid.innerHTML="";

  snap.forEach(doc=>{
    const data=doc.data();
    linkGrid.innerHTML+=`
      <div class="card">
        <div class="card-header">
          <b>${doc.id}</b>
          <div class="actions">
            <button class="icon-btn copy" onclick="copyLink('${doc.id}')">
              <i data-lucide="copy"></i>
            </button>
            <button class="icon-btn lock" onclick="resetLink('${doc.id}')">
              <i data-lucide="lock"></i>
            </button>
            <button class="icon-btn delete" onclick="deleteLink('${doc.id}')">
              <i data-lucide="trash-2"></i>
            </button>
          </div>
        </div>
        <span class="badge ${data.isActive?'open':'closed'}">
          ${data.isActive?'Đang mở':'Đang khóa'}
        </span>
      </div>
    `;
  });

  lucide.createIcons();
}

function copyLink(id){
  navigator.clipboard.writeText(location.origin+location.pathname+"?link="+id);
}

async function resetLink(id){
  await db.collection("ToolVeChaiV2_links").doc(id).update({isActive:true});
  loadLinks();
}

async function deleteLink(id){
  await db.collection("ToolVeChaiV2_links").doc(id).delete();
  loadLinks();
}

</script>

</body>
</html>
