<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tool Ve Chai Check VIP V2</title>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<style>
*{box-sizing:border-box}
body{margin:0;background:#0f0f0f;color:white;font-family:Arial}
.container{max-width:900px;margin:auto;padding:20px}

input{
width:100%;
padding:14px;
border-radius:12px;
border:1px solid #333;
background:#111;
color:white;
margin-top:12px;
}

button{
padding:10px 14px;
border-radius:10px;
border:none;
cursor:pointer;
font-weight:bold;
}

.primary{background:#2563eb;color:white;width:100%;margin-top:12px}
.green{background:#16a34a;color:white}
.orange{background:#f59e0b;color:white}
.red{background:#ef4444;color:white}

.card{
background:#1a1a1a;
padding:15px;
border-radius:14px;
margin-bottom:15px;
border:1px solid #2a2a2a;
}

.row{
display:flex;
gap:10px;
flex-wrap:wrap;
margin-top:10px;
}

.badge{
padding:4px 10px;
border-radius:20px;
font-size:12px;
font-weight:bold;
}

.open{background:#059669}
.lock{background:#dc2626}

#loginScreen{
position:fixed;
top:0;left:0;
width:100%;height:100%;
background:#000;
display:flex;
justify-content:center;
align-items:center;
z-index:9999;
}

.login-box{
width:360px;
background:#111;
padding:30px;
border-radius:20px;
border:1px solid gold;
}

hr{border:1px solid #333;margin:35px 0}
</style>
</head>

<body>

<div id="loginScreen">
  <div class="login-box">
    <h2 style="text-align:center;color:gold">ğŸ” Tool Ve Chai Admin V2</h2>
    <input id="loginEmail" placeholder="Nháº­p Gmail">
    <input id="loginPass" type="password" placeholder="Nháº­p Password">
    <button class="primary" onclick="secureLogin()">LOGIN</button>
    <div id="loginError" style="color:red;text-align:center;margin-top:10px"></div>
  </div>
</div>

<div class="container">

<h2>ğŸ›  Tool Ve Chai Check VIP V2</h2>

<input id="q" placeholder="Nháº­p 4 kÃ½ tá»± hoáº·c full mÃ£">
<button class="primary">CHECK</button>

<hr>

<h3>ğŸ”— Quáº£n lÃ½ Share Link V2</h3>
<button class="green" onclick="createLink()">+ Táº¡o link má»›i</button>
<div id="linksBox" style="margin-top:20px"></div>

<hr>

<div class="card" style="text-align:center">
âš  Tool chá»‰ mang tÃ­nh tham kháº£o.<br>
ğŸ’³ Vietcombank | Nguyen Minh Trung<br>
STK: 9907373199
</div>

</div>

<script>
const firebaseConfig={
apiKey:"AIzaSyCEL7BDXvmNi2dp1VNpua7b2plpTiTOK3U",
authDomain:"toolvechai.firebaseapp.com",
projectId:"toolvechai",
storageBucket:"toolvechai.firebasestorage.app",
messagingSenderId:"947125032083",
appId:"1:947125032083:web:a7335aa5fd446a44446966"
}

firebase.initializeApp(firebaseConfig)
const auth=firebase.auth()
const db=firebase.firestore()

/* LOGIN */
function secureLogin(){
const email=loginEmail.value.trim()
const pass=loginPass.value.trim()

auth.signInWithEmailAndPassword(email,pass)
.then(async()=>{
const doc=await db.collection("users").doc(email).get()
if(!doc.exists||doc.data().role!=="admin_v2"){
await auth.signOut()
loginError.innerText="KhÃ´ng cÃ³ quyá»n!"
return
}
loginScreen.remove()
})
.catch(()=>loginError.innerText="Sai Gmail hoáº·c Password!")
}

/* LINK SYSTEM */
const linksRef=db.collection("ToolVeChaiV2_links")
const sessionsRef=db.collection("ToolVeChaiV2_sessions")

function generateId(len=8){
const c="abcdefghijklmnopqrstuvwxyz0123456789"
let r=""
for(let i=0;i<len;i++) r+=c[Math.floor(Math.random()*c.length)]
return r
}

async function createLink(){
const id=generateId()
const expire=new Date(Date.now()+60*60*1000)

await linksRef.doc(id).set({
createdAt:firebase.firestore.FieldValue.serverTimestamp(),
createdBy:auth.currentUser.email,
expireAt:expire,
isActive:true
})
}

linksRef.orderBy("createdAt","desc").onSnapshot(snapshot=>{
renderLinks(snapshot.docs)
})

async function renderLinks(docs){
const box=document.getElementById("linksBox")
box.innerHTML=""

for(const d of docs){
const data=d.data()
const id=d.id

const sessionSnap=await sessionsRef.where("linkId","==",id).get()
const online=sessionSnap.size
const expired=data.expireAt&&data.expireAt.toDate()<new Date()
const active=data.isActive&&!expired

box.innerHTML+=`
<div class="card">
<b>ID:</b> ${id}<br>
<span class="badge ${active?"open":"lock"}">
${active?"ğŸŸ¢ ÄANG Má»":"ğŸ”´ ÄÃƒ KHÃ“A"}
</span>
<div>ğŸ‘¥ Online: ${online}</div>

<div class="row">
<button class="green" onclick="copyLink('${id}')">Copy</button>
<button class="orange" onclick="resetLink('${id}')">Reset</button>
<button class="red" onclick="deleteLink('${id}')">XÃ³a</button>
</div>
</div>
`
}
}

function copyLink(id){
const url=window.location.origin+window.location.pathname+"?link="+id
navigator.clipboard.writeText(url)
alert("ÄÃ£ copy link")
}

async function resetLink(oldId){
const oldDoc=await linksRef.doc(oldId).get()
const data=oldDoc.data()
const newId=generateId()

await linksRef.doc(newId).set({
...data,
createdAt:firebase.firestore.FieldValue.serverTimestamp(),
isActive:true
})

await linksRef.doc(oldId).delete()
renderLinks((await linksRef.orderBy("createdAt","desc").get()).docs)
}

async function deleteLink(id){
await linksRef.doc(id).delete()
renderLinks((await linksRef.orderBy("createdAt","desc").get()).docs)
}

/* LINK ACCESS CHECK */
const params=new URLSearchParams(window.location.search)
const linkId=params.get("link")

if(linkId){
linksRef.doc(linkId).get().then(doc=>{
if(!doc.exists){
document.body.innerHTML="<h2 style='color:red;text-align:center;margin-top:100px'>ğŸš« Link khÃ´ng tá»“n táº¡i</h2>"
return
}
const data=doc.data()
const expired=data.expireAt&&data.expireAt.toDate()<new Date()
if(!data.isActive||expired){
document.body.innerHTML="<h2 style='color:red;text-align:center;margin-top:100px'>ğŸš« Link Ä‘Ã£ háº¿t háº¡n hoáº·c bá»‹ khÃ³a</h2>"
}
})
}
</script>
</body>
</html>
