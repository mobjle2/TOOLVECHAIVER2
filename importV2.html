<script>
const firebaseConfig = {
  apiKey: "AIzaSyClXx0V66GQHKGO0EwQc0nYNguFLc705A0",
  authDomain: "toolvechaiver2.firebaseapp.com",
  projectId: "toolvechaiver2",
  storageBucket: "toolvechaiver2.firebasestorage.app",
  messagingSenderId: "855001765940",
  appId: "1:855001765940:web:0a562c54618377aaae5261"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const logEl = document.getElementById("log");

async function runImport() {

  try {

    logEl.innerText = "Bắt đầu import...\n";

    const batch = db.batch();

    data.forEach(item => {

      const docRef = db.collection("codes").doc(item.code);

      const docData = {
        code: item.code,
        full: item.code.replace(/-/g,""),
        head4: item.code.substring(0,4),
        tail4: item.code.slice(-4),
        search4: [
          item.code.substring(0,4),
          item.code.slice(-4)
        ],
        type: item.mmc ? "MMC" : "VIP",
        value: item.mmc ? item.mmc : item.vip,
        used:false,
        usedAt:"",
        usedBy:""
      };

      if(item.model){
        docData.models = item.model;
      }

      batch.set(docRef, docData);
    });

    await batch.commit();

    logEl.innerText += "IMPORT HOÀN TẤT ✅";

  } catch(err) {
    console.error(err);
    logEl.innerText += "\nLỖI: " + err.message;
  }
}
</script>
